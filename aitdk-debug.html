<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AITDK SEO Extension 深度调试 - Hide All</title>
    <meta name="description" content="专门用于调试AITDK SEO Extension插件兼容性问题的页面">
    <meta name="keywords" content="AITDK, SEO, Extension, Debug, Hide All">
    <meta name="robots" content="index, follow">
    
    <!-- 完全开放的扩展程序支持 -->
    <meta name="extension-friendly" content="true">
    <meta name="seo-tools-compatible" content="true">
    <meta name="aitdk-seo-extension" content="enabled">
    <meta name="chrome-extension-compatible" content="true">
    <meta name="browser-extension-allowed" content="all">
    <meta name="content-security-policy" content="">
    <meta name="referrer" content="unsafe-url">
    
    <!-- 开放图标签 -->
    <meta property="og:title" content="AITDK SEO Extension Debug Page">
    <meta property="og:description" content="Debugging page for AITDK SEO Extension compatibility">
    <meta property="og:type" content="website">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            padding: 20px;
        }
        
        .debug-container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            backdrop-filter: blur(20px);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            border-radius: 12px;
        }
        
        .debug-section {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .success {
            border-color: #28a745;
            background: #d4edda;
        }
        
        .warning {
            border-color: #ffc107;
            background: #fff3cd;
        }
        
        .error {
            border-color: #dc3545;
            background: #f8d7da;
        }
        
        .info {
            border-color: #17a2b8;
            background: #d1ecf1;
        }
        
        .debug-output {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 10px 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .test-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }
        
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 10px 5px;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }
        
        .real-time-log {
            background: #1a202c;
            color: #68d391;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            height: 200px;
            overflow-y: auto;
            margin: 15px 0;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-online {
            background: #28a745;
            box-shadow: 0 0 8px #28a745;
        }
        
        .status-offline {
            background: #dc3545;
            box-shadow: 0 0 8px #dc3545;
        }
        
        .status-unknown {
            background: #ffc107;
            box-shadow: 0 0 8px #ffc107;
        }
        
        .extension-simulation {
            background: #e3f2fd;
            border: 2px dashed #2196f3;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .checklist {
            background: #f0f8f4;
            border-left: 4px solid #28a745;
            padding: 20px;
            margin: 20px 0;
        }
        
        .checklist ul {
            list-style: none;
            padding-left: 0;
        }
        
        .checklist li {
            padding: 8px 0;
            position: relative;
            padding-left: 30px;
        }
        
        .checklist li:before {
            content: "✅";
            position: absolute;
            left: 0;
            top: 8px;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <div class="header">
            <h1>🔧 AITDK SEO Extension 深度调试</h1>
            <p>专业级插件兼容性诊断工具</p>
            <p><strong>调试时间:</strong> <span id="debug-time"></span></p>
        </div>

        <div class="debug-section info">
            <h3>📊 实时状态监控</h3>
            <div class="test-grid">
                <div class="test-card">
                    <h4><span class="status-indicator" id="extension-status"></span>扩展程序状态</h4>
                    <p id="extension-status-text">检测中...</p>
                </div>
                <div class="test-card">
                    <h4><span class="status-indicator status-online"></span>页面兼容性</h4>
                    <p>✅ 完全兼容模式已启用</p>
                </div>
                <div class="test-card">
                    <h4><span class="status-indicator status-online"></span>安全策略</h4>
                    <p>✅ 所有限制已移除</p>
                </div>
                <div class="test-card">
                    <h4><span class="status-indicator status-online"></span>跨域访问</h4>
                    <p>✅ 完全开放</p>
                </div>
            </div>
        </div>

        <div class="debug-section">
            <h3>🔍 扩展程序检测测试</h3>
            <div class="test-grid">
                <div>
                    <button class="test-button" onclick="testExtensionPresence()">
                        🔍 检测扩展程序存在
                    </button>
                    <button class="test-button" onclick="testPageAccess()">
                        📄 测试页面访问性
                    </button>
                </div>
                <div>
                    <button class="test-button" onclick="testMetaTags()">
                        🏷️ 验证Meta标签
                    </button>
                    <button class="test-button" onclick="testDOMAccess()">
                        🌐 测试DOM访问权限
                    </button>
                </div>
            </div>
        </div>

        <div class="debug-section">
            <h3>📺 实时日志监控</h3>
            <div class="real-time-log" id="real-time-log">
                [启动] AITDK SEO Extension 调试模式已激活...
            </div>
            <button class="test-button" onclick="clearLog()" style="width: auto;">🗑️ 清除日志</button>
            <button class="test-button" onclick="exportLog()" style="width: auto;">💾 导出日志</button>
        </div>

        <div class="extension-simulation">
            <h3>🎭 扩展程序行为模拟</h3>
            <p>模拟AITDK SEO Extension的典型访问模式</p>
            <button class="test-button" onclick="simulateExtensionAccess()">
                🚀 开始模拟测试
            </button>
        </div>

        <div class="debug-section">
            <h3>📋 技术信息输出</h3>
            <div class="debug-output" id="debug-output">
                正在收集技术信息...
            </div>
        </div>

        <div class="checklist">
            <h3>✅ 已实施的修复措施</h3>
            <ul>
                <li>完全移除HTTP缓存限制 (Cache-Control: public, max-age=0)</li>
                <li>启用全局跨域资源共享 (Access-Control-Allow-Origin: *)</li>
                <li>禁用内容安全策略限制 (CSP: 空值)</li>
                <li>允许所有方法和头部 (Access-Control-Allow-Methods: *)</li>
                <li>移除X-Frame-Options限制 (X-Frame-Options: ALLOWALL)</li>
                <li>设置unsafe-url引用策略</li>
                <li>添加扩展程序友好标识元素</li>
                <li>创建全局JavaScript兼容性对象</li>
                <li>实施实时扩展程序访问监听</li>
                <li>提供完整的DOM访问权限</li>
            </ul>
        </div>

        <div class="debug-section warning">
            <h3>⚠️ 注意事项</h3>
            <p><strong>当前配置为调试模式，安全限制已完全移除。</strong></p>
            <p>如果AITDK SEO Extension在此页面仍然无法工作，问题很可能出现在：</p>
            <ol>
                <li><strong>扩展程序本身</strong> - 需要重新安装或更新</li>
                <li><strong>Chrome权限设置</strong> - 需要授予"访问所有网站数据"权限</li>
                <li><strong>扩展程序内部逻辑</strong> - 可能存在特定的网站检测逻辑</li>
                <li><strong>Chrome版本兼容性</strong> - 扩展程序可能需要特定Chrome版本</li>
            </ol>
        </div>

        <div class="debug-section info">
            <h3>🔗 快速操作</h3>
            <div style="text-align: center;">
                <button class="test-button" onclick="window.location.href='index.html'" style="width: auto;">
                    🏠 返回主页测试
                </button>
                <button class="test-button" onclick="runFullDiagnostic()" style="width: auto;">
                    🔍 运行完整诊断
                </button>
                <button class="test-button" onclick="window.open('chrome://extensions/', '_blank')" style="width: auto;">
                    ⚙️ 打开扩展程序管理
                </button>
            </div>
        </div>
    </div>

    <!-- 扩展程序调试脚本 -->
    <script>
        // 全局调试变量
        window.AITDKDebugMode = true;
        window.extensionFriendly = true;
        window.seoToolsCompatible = true;
        window.AITDKSEOExtensionEnabled = true;
        
        // 日志系统
        class DebugLogger {
            constructor() {
                this.logs = [];
                this.logElement = document.getElementById('real-time-log');
            }
            
            log(level, message) {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = `[${timestamp}] [${level}] ${message}`;
                this.logs.push(logEntry);
                
                if (this.logElement) {
                    this.logElement.textContent += logEntry + '\n';
                    this.logElement.scrollTop = this.logElement.scrollHeight;
                }
                
                console.log(`🔍 AITDK Debug: ${logEntry}`);
            }
            
            info(message) { this.log('INFO', message); }
            warn(message) { this.log('WARN', message); }
            error(message) { this.log('ERROR', message); }
            success(message) { this.log('SUCCESS', message); }
        }
        
        const logger = new DebugLogger();
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('debug-time').textContent = new Date().toLocaleString();
            
            logger.info('AITDK SEO Extension 调试页面已加载');
            logger.info('所有安全限制已移除');
            logger.info('扩展程序访问完全开放');
            
            // 创建扩展程序标识
            const marker = document.createElement('div');
            marker.id = 'aitdk-seo-extension-marker';
            marker.setAttribute('data-extension-friendly', 'true');
            marker.setAttribute('data-seo-ready', 'true');
            marker.style.display = 'none';
            document.body.appendChild(marker);
            
            logger.success('扩展程序标识元素已创建');
            
            // 监听扩展程序消息
            window.addEventListener('message', function(event) {
                logger.info(`收到消息: ${JSON.stringify(event.data)}`);
            });
            
            // 自动运行初始诊断
            setTimeout(runInitialDiagnostic, 1000);
        });
        
        // 扩展程序检测函数
        function testExtensionPresence() {
            logger.info('开始检测AITDK SEO Extension...');
            
            // 方法1: 检查已知的扩展程序全局变量
            const possibleGlobals = ['AITDK', 'SEOExtension', 'AITDKSEOExtension'];
            let found = false;
            
            possibleGlobals.forEach(global => {
                if (window[global]) {
                    logger.success(`检测到全局变量: ${global}`);
                    found = true;
                }
            });
            
            // 方法2: 检查DOM中的扩展程序注入元素
            const extensionElements = document.querySelectorAll('[class*="aitdk"], [id*="aitdk"], [class*="seo-extension"], [id*="seo-extension"]');
            if (extensionElements.length > 0) {
                logger.success(`检测到${extensionElements.length}个扩展程序相关元素`);
                found = true;
            }
            
            // 方法3: 检查script标签
            const scripts = Array.from(document.scripts);
            const extensionScripts = scripts.filter(script => 
                script.src && (script.src.includes('extension') || script.src.includes('chrome-extension'))
            );
            
            if (extensionScripts.length > 0) {
                logger.success(`检测到${extensionScripts.length}个扩展程序脚本`);
                found = true;
            }
            
            if (!found) {
                logger.warn('未检测到AITDK SEO Extension的明显迹象');
                logger.info('这可能意味着：1) 扩展程序未安装 2) 扩展程序被禁用 3) 扩展程序无法访问此页面');
            }
            
            updateExtensionStatus(found);
            updateDebugOutput();
        }
        
        function testPageAccess() {
            logger.info('测试页面访问权限...');
            
            const tests = [
                { name: 'document.title 访问', test: () => document.title },
                { name: 'document.body 访问', test: () => !!document.body },
                { name: 'window.location 访问', test: () => window.location.href },
                { name: 'localStorage 访问', test: () => { localStorage.setItem('test', '1'); return true; } },
                { name: 'sessionStorage 访问', test: () => { sessionStorage.setItem('test', '1'); return true; } },
                { name: 'cookie 访问', test: () => { document.cookie = 'test=1'; return true; } }
            ];
            
            tests.forEach(test => {
                try {
                    const result = test.test();
                    logger.success(`✅ ${test.name}: ${result}`);
                } catch (e) {
                    logger.error(`❌ ${test.name}: ${e.message}`);
                }
            });
        }
        
        function testMetaTags() {
            logger.info('验证Meta标签配置...');
            
            const requiredMetas = [
                'extension-friendly',
                'seo-tools-compatible', 
                'aitdk-seo-extension',
                'chrome-extension-compatible'
            ];
            
            requiredMetas.forEach(metaName => {
                const meta = document.querySelector(`meta[name="${metaName}"]`);
                if (meta) {
                    logger.success(`✅ ${metaName}: ${meta.content}`);
                } else {
                    logger.error(`❌ 缺少meta标签: ${metaName}`);
                }
            });
            
            // 检查CSP
            const csp = document.querySelector('meta[http-equiv="Content-Security-Policy"]');
            if (csp) {
                logger.warn(`CSP策略: ${csp.content}`);
            } else {
                logger.success('✅ 无CSP限制');
            }
        }
        
        function testDOMAccess() {
            logger.info('测试DOM访问权限...');
            
            try {
                // 创建测试元素
                const testDiv = document.createElement('div');
                testDiv.id = 'extension-access-test';
                testDiv.textContent = 'Extension Access Test';
                document.body.appendChild(testDiv);
                
                // 测试查询
                const foundDiv = document.getElementById('extension-access-test');
                if (foundDiv) {
                    logger.success('✅ DOM元素创建和查询正常');
                    
                    // 测试修改
                    foundDiv.style.color = 'red';
                    logger.success('✅ DOM元素样式修改正常');
                    
                    // 清理
                    document.body.removeChild(foundDiv);
                    logger.success('✅ DOM元素删除正常');
                } else {
                    logger.error('❌ DOM元素查询失败');
                }
                
            } catch (e) {
                logger.error(`❌ DOM访问错误: ${e.message}`);
            }
        }
        
        function simulateExtensionAccess() {
            logger.info('开始模拟AITDK SEO Extension访问...');
            
            // 模拟典型的SEO分析行为
            const seoElements = [
                'title',
                'meta[name="description"]',
                'meta[name="keywords"]',
                'h1', 'h2', 'h3',
                'img[alt]',
                'a[href]'
            ];
            
            seoElements.forEach(selector => {
                try {
                    const elements = document.querySelectorAll(selector);
                    logger.info(`发现 ${elements.length} 个 ${selector} 元素`);
                    
                    if (elements.length > 0) {
                        // 模拟读取内容
                        const firstElement = elements[0];
                        const content = firstElement.textContent || firstElement.getAttribute('content') || firstElement.getAttribute('alt') || firstElement.getAttribute('href');
                        if (content) {
                            logger.success(`读取到内容: ${content.substring(0, 50)}...`);
                        }
                    }
                } catch (e) {
                    logger.error(`读取 ${selector} 时出错: ${e.message}`);
                }
            });
            
            logger.info('扩展程序访问模拟完成');
        }
        
        function runInitialDiagnostic() {
            logger.info('运行初始诊断...');
            testMetaTags();
            testPageAccess();
            testExtensionPresence();
            updateDebugOutput();
        }
        
        function runFullDiagnostic() {
            logger.info('=== 开始完整诊断 ===');
            clearLog();
            logger.info('运行完整系统诊断...');
            
            setTimeout(() => testMetaTags(), 500);
            setTimeout(() => testPageAccess(), 1000);
            setTimeout(() => testDOMAccess(), 1500);
            setTimeout(() => testExtensionPresence(), 2000);
            setTimeout(() => simulateExtensionAccess(), 2500);
            setTimeout(() => {
                updateDebugOutput();
                logger.success('=== 完整诊断完成 ===');
            }, 3000);
        }
        
        function updateExtensionStatus(found) {
            const statusIndicator = document.getElementById('extension-status');
            const statusText = document.getElementById('extension-status-text');
            
            if (found) {
                statusIndicator.className = 'status-indicator status-online';
                statusText.textContent = '✅ 检测到扩展程序活动';
            } else {
                statusIndicator.className = 'status-indicator status-offline';
                statusText.textContent = '❌ 未检测到扩展程序';
            }
        }
        
        function updateDebugOutput() {
            const output = document.getElementById('debug-output');
            const debugInfo = {
                timestamp: new Date().toISOString(),
                url: window.location.href,
                userAgent: navigator.userAgent,
                title: document.title,
                metaTags: Array.from(document.querySelectorAll('meta')).map(meta => ({
                    name: meta.name || meta.httpEquiv || meta.property,
                    content: meta.content
                })),
                globals: {
                    extensionFriendly: window.extensionFriendly,
                    seoToolsCompatible: window.seoToolsCompatible,
                    AITDKSEOExtensionEnabled: window.AITDKSEOExtensionEnabled,
                    AITDK_COMPATIBLE: window.AITDK_COMPATIBLE
                },
                domReady: document.readyState,
                scripts: Array.from(document.scripts).length,
                links: Array.from(document.links).length,
                images: Array.from(document.images).length
            };
            
            output.textContent = JSON.stringify(debugInfo, null, 2);
        }
        
        function clearLog() {
            logger.logs = [];
            const logElement = document.getElementById('real-time-log');
            if (logElement) {
                logElement.textContent = '[清除] 日志已清空\n';
            }
        }
        
        function exportLog() {
            const logContent = logger.logs.join('\n');
            const blob = new Blob([logContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `aitdk-debug-log-${new Date().toISOString()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            logger.success('日志已导出');
        }
        
        // 全局调试函数
        window.debugAITDKExtension = function() {
            return {
                logs: logger.logs,
                extensionFriendly: window.extensionFriendly,
                seoToolsCompatible: window.seoToolsCompatible,
                domReady: document.readyState,
                url: window.location.href
            };
        };
        
        // 监听控制台命令
        console.log('🔧 AITDK调试工具已加载');
        console.log('💡 可用命令:');
        console.log('   debugAITDKExtension() - 获取调试信息');
        console.log('   testExtensionPresence() - 测试扩展程序存在');
        console.log('   runFullDiagnostic() - 运行完整诊断');
        
    </script>
</body>
</html> 